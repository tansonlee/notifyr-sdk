{"code":"import { __awaiter, __generator } from \"tslib\";\r\nimport { api_endpoint } from '../constants';\r\nimport { getUserToken, storeUserToken } from './storage';\r\nexport var authenticate = function (apiKey) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var currentToken, response, _a, token, error;\r\n    return __generator(this, function (_b) {\r\n        switch (_b.label) {\r\n            case 0:\r\n                currentToken = getUserToken();\r\n                // Already authenticated.\r\n                if (currentToken) {\r\n                    return [2 /*return*/];\r\n                }\r\n                return [4 /*yield*/, fetch(\"\".concat(api_endpoint, \"/api/auth/get-token\"), {\r\n                        method: 'POST',\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                        },\r\n                        body: JSON.stringify({\r\n                            apiKey: apiKey,\r\n                        }),\r\n                    })];\r\n            case 1:\r\n                response = _b.sent();\r\n                return [4 /*yield*/, response.json()];\r\n            case 2:\r\n                _a = _b.sent(), token = _a.token, error = _a.error;\r\n                if (error) {\r\n                    console.error(error);\r\n                    return [2 /*return*/];\r\n                }\r\n                storeUserToken(token);\r\n                return [2 /*return*/];\r\n        }\r\n    });\r\n}); };\r\n//# sourceMappingURL=authenticate.js.map","references":["/Users/tansonlee/coding/notifyr/notifyr-sdk/src/constants.ts","/Users/tansonlee/coding/notifyr/notifyr-sdk/src/lib/storage.ts"],"map":"{\"version\":3,\"file\":\"authenticate.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/lib/authenticate.ts\"],\"names\":[],\"mappings\":\";AAAA,OAAO,EAAE,YAAY,EAAE,MAAM,cAAc,CAAC;AAC5C,OAAO,EAAE,YAAY,EAAE,cAAc,EAAE,MAAM,WAAW,CAAC;AAEzD,MAAM,CAAC,IAAM,YAAY,GAAG,UAAO,MAAc;;;;;gBAC1C,YAAY,GAAG,YAAY,EAAE,CAAC;gBAEpC,yBAAyB;gBACzB,IAAI,YAAY,EAAE;oBACjB,sBAAO;iBACP;gBAGgB,qBAAM,KAAK,CAAC,UAAG,YAAY,wBAAqB,EAAE;wBAClE,MAAM,EAAE,MAAM;wBACd,OAAO,EAAE;4BACR,cAAc,EAAE,kBAAkB;yBAClC;wBACD,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC;4BACpB,MAAM,QAAA;yBACN,CAAC;qBACF,CAAC,EAAA;;gBARI,QAAQ,GAAG,SAQf;gBAEuB,qBAAM,QAAQ,CAAC,IAAI,EAAE,EAAA;;gBAAxC,KAAmB,SAAqB,EAAtC,KAAK,WAAA,EAAE,KAAK,WAAA;gBAEpB,IAAI,KAAK,EAAE;oBACV,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBACrB,sBAAO;iBACP;gBAED,cAAc,CAAC,KAAK,CAAC,CAAC;;;;KACtB,CAAC\"}","dts":{"name":"/Users/tansonlee/coding/notifyr/notifyr-sdk/node_modules/.cache/rollup-plugin-typescript2/placeholder/lib/authenticate.d.ts","writeByteOrderMark":false,"text":"export declare const authenticate: (apiKey: string) => Promise<void>;\r\n"}}
